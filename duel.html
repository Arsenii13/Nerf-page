<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blaster Duel</title>
  <style>
    body {
      font-family: 'Arial Black', sans-serif;
      background: linear-gradient(135deg, #f76d00 0%, #ffb347 100%);
      color: white;
      margin: 0;
      padding: 0;
      text-align: center;
      user-select: none;
    }
    .container {
      max-width: 480px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 16px;
      box-shadow: 0 0 15px #f76d00;
    }
    h1 {
      font-size: 2.4rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px #000;
    }
    #blaster-img {
      width: 150px;
      margin: 15px auto 30px;
      display: block;
      filter: drop-shadow(2px 2px 2px #000);
    }
    #modeSelect p {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    button {
      padding: 12px 24px;
      margin: 8px 5px;
      font-size: 1.1rem;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      background-color: #222;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: #444;
    }
    button:disabled {
      background-color: #555;
      cursor: default;
    }
    .status {
      font-size: 1.1rem;
      margin: 8px 0;
      user-select: none;
    }
    .health-bar, .ammo-bar {
      height: 20px;
      background: #444;
      border-radius: 12px;
      overflow: hidden;
      margin: 6px auto 12px;
      max-width: 280px;
      position: relative;
      box-shadow: inset 0 0 5px #000;
    }
    .health-fill {
      background: #ff4d4d;
      height: 100%;
      width: 100%;
      transition: width 0.4s ease;
      box-shadow: 0 0 8px #ff2222;
    }
    .ammo-fill {
      background: #ffc107;
      height: 100%;
      width: 100%;
      transition: width 0.4s ease;
      box-shadow: 0 0 8px #ffaa00;
    }
    .choice-section {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .flash-hit {
      animation: flashRed 0.3s ease forwards;
    }
    @keyframes flashRed {
      0% { background-color: #f76d00; }
      50% { background-color: #ff4d4d; }
      100% { background-color: #f76d00; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üî´ Blaster Duel üî´</h1>
    <img id="blaster-img" src="https://upload.wikimedia.org/wikipedia/commons/0/01/Nerf_Maverick_REV-6.jpg" alt="Nerf blaster" />

    <div id="modeSelect">
      <p>Select a mode:</p>
      <button id="btnAI">1P vs AI</button>
      <button id="btn2P">2 Player</button>
    </div>

    <div id="gameUI" class="hidden">
      <div id="turnDisplay" class="status"></div>

      <div id="player1Status" class="status">
        <div>Player 1</div>
        <div class="health-bar"><div id="player1Health" class="health-fill"></div></div>
        <div class="ammo-bar"><div id="player1Ammo" class="ammo-fill"></div></div>
      </div>

      <div id="player2Status" class="status">
        <div id="player2Name">AI</div>
        <div class="health-bar"><div id="player2Health" class="health-fill"></div></div>
        <div class="ammo-bar"><div id="player2Ammo" class="ammo-fill"></div></div>
      </div>

      <div class="choice-section" id="choiceButtons">
        <button id="shootBtn">üî´ Shoot</button>
        <button id="reloadBtn">üîÑ Reload</button>
        <button id="dodgeBtn">‚Ü©Ô∏è Dodge</button>
      </div>

      <div id="result" class="status"></div>
      <button id="restartBtn" class="hidden">Restart</button>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="shootSound" src="https://cdn.pixabay.com/audio/2022/03/31/audio_d4c61d60b1.mp3"></audio>
  <audio id="reloadSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2307d29917.mp3"></audio>
  <audio id="hitSound" src="https://cdn.pixabay.com/audio/2022/02/23/audio_a4fe9e9d1b.mp3"></audio>
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_bfccdb9ba9.mp3" loop></audio>

  <script>
    // Game state
    let mode = '';
    let turn = 1;
    let isPlayer1Turn = true;
    let player = { hp: 3, ammo: 3, choice: '' };
    let enemy = { hp: 3, ammo: 3, choice: '' };

    // Difficulty levels for AI
    const difficulties = {
      easy() {
        if (enemy.ammo === 0) return Math.random() < 0.7 ? 'reload' : 'dodge';
        const r = Math.random();
        if (r < 0.5) return 'shoot';
        if (r < 0.75) return 'reload';
        return 'dodge';
      },
      medium() {
        if (enemy.ammo === 0) return 'reload';
        if (player.ammo > 0 && enemy.ammo > 0) {
          if (Math.random() < 0.6) return 'shoot';
        }
        if (enemy.ammo < 6) return 'reload';
        return 'dodge';
      },
      hard() {
        if (enemy.ammo === 0) return 'reload';
        if (player.ammo > 0) {
          if (Math.random() < 0.8) return 'shoot';
        }
        if (enemy.ammo < 6) return 'reload';
        return 'dodge';
      }
    };

    // Cached DOM elements
    const modeSelect = document.getElementById('modeSelect');
    const btnAI = document.getElementById('btnAI');
    const btn2P = document.getElementById('btn2P');
    const gameUI = document.getElementById('gameUI');
    const turnDisplay = document.getElementById('turnDisplay');
    const choiceButtons = document.getElementById('choiceButtons');
    const result = document.getElementById('result');
    const restartBtn = document.getElementById('restartBtn');

    const shootBtn = document.getElementById('shootBtn');
    const reloadBtn = document.getElementById('reloadBtn');
    const dodgeBtn = document.getElementById('dodgeBtn');

    const player1Health = document.getElementById('player1Health');
    const player1Ammo = document.getElementById('player1Ammo');
    const player2Health = document.getElementById('player2Health');
    const player2Ammo = document.getElementById('player2Ammo');
    const player2Name = document.getElementById('player2Name');

    const shootSound = document.getElementById('shootSound');
    const reloadSound = document.getElementById('reloadSound');
    const hitSound = document.getElementById('hitSound');
    const bgMusic = document.getElementById('bgMusic');

    // Initialize
    function initGame(selectedMode) {
      mode = selectedMode;
      player.hp = 3;
      player.ammo = 3;
      enemy.hp = 3;
      enemy.ammo = 3;
      isPlayer1Turn = true;
      turn = 1;
      player.choice = '';
      enemy.choice = '';

      modeSelect.style.display = 'none';
      gameUI.classList.remove('hidden');
      restartBtn.classList.add('hidden');
      result.textContent = '';
      choiceButtons.style.display = 'flex';

      player2Name.textContent = mode === '2P' ? 'Player 2' : 'AI';

      updateUI();
      turnDisplay.textContent = `Turn ${turn} - Player 1's turn`;

      // Start background music softly
      bgMusic.volume = 0.2;
      bgMusic.play();
    }

    function updateUI() {
      player1Health.style.width = (player.hp / 3) * 100 + '%';
      player1Ammo.style.width = (player.ammo / 6) * 100 + '%';

      player2Health.style.width = (enemy.hp / 3) * 100 + '%';
      player2Ammo.style.width = (enemy.ammo / 6) * 100 + '%';

      shootBtn.disabled = player.ammo === 0;
    }

    // Player action handlers
    shootBtn.onclick = () => playerAction('shoot');
    reloadBtn.onclick = () => playerAction('reload');
    dodgeBtn.onclick = () => playerAction('dodge');

    // Mode select handlers
    btnAI.onclick = () => initGame('AI');
    btn2P.onclick = () => initGame('2P');

    function playerAction(choice) {
      if (mode === 'AI') {
        player.choice = choice;
        enemy.choice = aiChooseAction();
        resolveTurn();
      } else {
        if (isPlayer1Turn) {
          player.choice = choice;
          isPlayer1Turn = false;
          turnDisplay.textContent = `Turn ${turn} - Player 2's turn`;
          choiceButtons.style.pointerEvents = 'none'; // Disable buttons while waiting second player
          setTimeout(() => {
            choiceButtons.style.pointerEvents = 'auto';
          }, 500);
        } else {
          enemy.choice = choice;
          resolveTurn();
        }
      }
    }

    // AI action chooser with adjustable difficulty
    // Change difficulty here: easy, medium, hard
    function aiChooseAction() {
      return difficulties.medium();
    }

    function resolveTurn() {
      // Show choices
      result.textContent = `Player 1 chose ${emoji(player.choice)}, ${mode === '2P' ? 'Player 2' : 'AI'} chose ${emoji(enemy.choice)}.`;

      // Resolve actions with priority:
      // Shoot reduces ammo, if opponent not dodging or dodge fails, reduce hp
      // Reload adds ammo
      // Dodge no direct effect, chance to avoid

      let pHitMsg = '';
      let eHitMsg = '';

      // Process Player 1 action
      if (player.choice === 'shoot') {
        if (player.ammo > 0) {
          player.ammo--;
          shootSound.play();
          if (enemy.choice !== 'dodge' || Math.random() > 0.5) {
            enemy.hp--;
            flashHit(player2Health);
            hitSound.play();
            pHitMsg = 'Hit!';
          } else {
            pHitMsg = 'Missed (dodged)!';
          }
        } else {
          pHitMsg = 'No ammo!';
        }
      } else if (player.choice === 'reload') {
        if (player.ammo < 6) {
          player.ammo++;
          reloadSound.play();
        }
      }

      // Process Player 2 / AI action
      if (enemy.choice === 'shoot') {
        if (enemy.ammo > 0) {
          enemy.ammo--;
          shootSound.play();
          if (player.choice !== 'dodge' || Math.random() > 0.5) {
            player.hp--;
            flashHit(player1Health);
            hitSound.play();
            eHitMsg = 'Hit!';
          } else {
            eHitMsg = 'Missed (dodged)!';
          }
        } else {
          eHitMsg = 'No ammo!';
        }
      } else if (enemy.choice === 'reload') {
        if (enemy.ammo < 6) {
          enemy.ammo++;
          reloadSound.play();
        }
      }

      updateUI();

      // Show hit/miss messages combined
      let combinedMsg = '';
      if (pHitMsg) combinedMsg += `Player 1: ${pHitMsg} `;
      if (eHitMsg) combinedMsg += `${mode === '2P' ? 'Player 2' : 'AI'}: ${eHitMsg}`;

      if (combinedMsg) {
        result.textContent += '\n' + combinedMsg;
      }

      // Check win condition
      if (player.hp <= 0 && enemy.hp <= 0) {
        result.textContent = "It's a draw!";
        endGame();
        return;
      } 
      if (player.hp <= 0) {
        result.textContent = (mode === '2P' ? "Player 2 wins!" : "AI wins!");
        endGame();
        return;
      }
      if (enemy.hp <= 0) {
        result.textContent = "Player 1 wins!";
        endGame();
        return;
      }

      // Continue game
      turn++;
      isPlayer1Turn = true;
      turnDisplay.textContent = `Turn ${turn} - Player 1's turn`;
    }

    function flashHit(element) {
      element.classList.add('flash-hit');
      setTimeout(() => element.classList.remove('flash-hit'), 300);
    }

    function emoji(action) {
      switch(action) {
        case 'shoot': return 'üî´';
        case 'reload': return 'üîÑ';
        case 'dodge': return '‚Ü©Ô∏è';
        default: return '';
      }
    }

    function endGame() {
      choiceButtons.style.display = 'none';
      restartBtn.classList.remove('hidden');
      turnDisplay.textContent = "Game Over";
      bgMusic.pause();
    }

    restartBtn.onclick = () => {
      location.reload();
    }
  </script>
</body>
</html>